# 好友功能测试指南

## 为什么"获取收到的请求"是空的？

**原因**：因为还没有人向你发送好友请求。

## 完整测试流程

### 第一步：创建测试用户

1. 打开 `create_test_users.html`
2. 创建至少2个测试用户：

**用户A：**
- 昵称：张三
- 唯一标识：zhangsan
- 密码：123456

**用户B：**
- 昵称：李四
- 唯一标识：lisi
- 密码：123456

3. 创建成功后，复制两个用户的ID（UUID格式）

### 第二步：使用简化测试页面

1. 打开 `friendship_simple_test.html`
2. 按照以下步骤操作：

#### 步骤1：用户A发送好友请求
1. 点击"用户A"按钮
2. 在"当前用户ID"输入框中粘贴用户A的ID
3. 点击"设置当前用户"
4. 在"搜索用户"中输入"李四"或"lisi"
5. 点击"搜索用户"
6. 复制搜索结果中用户B的ID
7. 在"发送好友请求给"中输入用户B的ID
8. 点击"发送好友请求"

#### 步骤2：用户B查看并接受请求
1. 点击"用户B"按钮
2. 在"当前用户ID"输入框中粘贴用户B的ID
3. 点击"设置当前用户"
4. 点击"获取收到的请求"
5. 现在你应该能看到一个请求了！
6. **重要**：系统会自动填充正确的请求ID，或者你可以直接点击"一键接受第一个请求"
7. 如果想手动操作：复制请求结果中的 `request_id` 字段（不是 `sender_id`）
8. 点击"接受请求"

#### 步骤3：验证好友关系
1. 点击"通用功能"中的"获取好友列表"
2. 你应该能看到用户A和用户B已经是好友了

### 第三步：测试评分功能

1. 在主应用中用用户A给一些餐厅评分
2. 在测试页面中点击"获取所有好友评分"
3. 你应该能看到用户A的评分

## 常见问题解决

### 问题1：搜索不到用户
**解决**：确保用户已创建，搜索时使用正确的昵称或唯一标识

### 问题2：发送请求失败
**可能原因**：
- 已经是好友关系
- 已存在待处理的请求
- 用户ID格式错误

### 问题3：接受请求失败
**可能原因**：
- 请求ID错误（最常见：复制了sender_id而不是request_id）
- 请求已被处理
- 不是请求的接收者

**解决方法**：
- 确保复制的是 `request_id` 字段，不是 `sender_id` 字段
- 使用"一键接受第一个请求"功能避免手动输入错误
- 检查请求是否已被处理

## 测试数据示例

### 创建用户示例
```
用户A: 张三 (zhangsan)
用户B: 李四 (lisi)  
用户C: 王五 (wangwu)
```

### 测试流程示例
1. 张三搜索"李四" → 找到李四
2. 张三向李四发送好友请求
3. 李四查看收到的请求 → 看到张三的请求
4. 李四接受请求
5. 张三和李四成为好友
6. 查看好友列表 → 显示好友关系

## 调试技巧

### 1. 检查数据库
在Supabase控制台中查看：
- `users` 表：确认用户存在
- `friend_requests` 表：查看请求状态
- `friendships` 表：查看好友关系

### 2. 使用浏览器控制台
打开开发者工具，查看：
- 网络请求是否成功
- JavaScript错误信息
- API返回的数据

### 3. 逐步测试
- 先测试用户搜索
- 再测试发送请求
- 最后测试接受请求

## 预期结果

### 成功发送好友请求后
```json
{
  "id": "请求ID",
  "sender_id": "发送者ID",
  "receiver_id": "接收者ID",
  "message": "你好，我想加你为好友",
  "status": "pending",
  "created_at": "创建时间"
}
```

### 成功接受好友请求后
```json
{
  "success": true,
  "request": {
    // 请求详情
  }
}
```

### 获取好友列表后
```json
[
  {
    "user_id": "用户ID",
    "friend_id": "好友ID",
    "friend_nickname": "好友昵称",
    "friendship_created_at": "好友关系建立时间"
  }
]
```

## 下一步

测试完成后，你可以：
1. 在主应用中集成好友功能
2. 开发前端好友管理界面
3. 添加实时通知功能
4. 优化用户体验 